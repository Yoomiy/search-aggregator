<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>Search Aggregator</title>
    
</head>
<body>
    <div class="container">
        {% block content %}{% endblock %}
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Ensure the script runs after the DOM is loaded
        document.addEventListener("DOMContentLoaded", function () {
            const form = document.getElementById("search-form");
            const resultsDiv = document.getElementById("results");
     
            form.addEventListener("submit", async function (event) {
                event.preventDefault(); // Prevent the form from submitting normally
                console.log("Form submitted");
     
                // Collect form data
                const formData = new FormData(form);
                const response = await fetch("/search", {
                    method: "POST",
                    body: formData
                });
     
                if (!response.ok) {
                    resultsDiv.innerHTML = `<p class="text-danger">Error fetching results. Please try again.</p>`;
                    return;
                }
     
                const results = await response.json();
                resultsDiv.innerHTML = ""; // Clear previous results
     
                if (results.error) {
                    resultsDiv.innerHTML = `<p class="text-danger">${results.error}</p>`;                    
                } else {
                    results.forEach(result => {
                        const resultDiv = document.createElement("div");
                        resultDiv.classList.add("mb-3", "p-3", "border", "rounded");
     
                        resultDiv.innerHTML = `
                            <h5>${result.title}</h5>
                            ${result.snippet ? `<p>${result.snippet}</p>` : ''}
                            <a href="${result.link}" target="_blank">${result.link}</a>
                            <p><strong>Source:</strong> ${result.source}</p>
                        `;
                        resultsDiv.appendChild(resultDiv);
                    });
                }
            });
        });
     </script>     
</body>
</html>
