<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>Search Aggregator</title>
    
</head>
<body>
    <div class="container">
        {% block content %}{% endblock %}
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Ensure the script runs after the DOM is loaded
        document.addEventListener("DOMContentLoaded", function () {
            const form = document.getElementById("search-form");
            const resultsDiv = document.getElementById("results");
            const loadingDiv = document.getElementById("loading");
     
            form.addEventListener("submit", async function (event) {
                event.preventDefault(); // Prevent the form from submitting normally
                console.log("Form submitted");
                loadingDiv.classList.remove("d-none"); // Show spinner
     
                // Collect form data
                const formData = new FormData(form);
                const response = await fetch("/search", {
                    method: "POST",
                    body: formData
                });
     
                if (!response.ok) {
                    resultsDiv.innerHTML = `<p class="text-danger">Error fetching results. Please try again.</p>`;
                    return;
                }
     
                const results = await response.json();
                resultsDiv.innerHTML = ""; // Clear previous results
     
                if (results.error) {
                    resultsDiv.innerHTML = `<p class="text-danger">${results.error}</p>`;
                    loadingDiv.classList.add("d-none"); // Hide spinner                 
                } else {
                    results.forEach(result => {
                        const resultCard = `
                            <div class="card mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">${result.title}</h5>
                                    ${result.snippet ? `<p class="card-text">${result.snippet}</p>` : ''}
                                    <a href="${result.link}" class="btn btn-primary" target="_blank">Visit Link</a>
                                    <p class="mt-2"><small class="text-muted">Source: ${result.source}</small></p>
                                </div>
                            </div>
                        `;
                        loadingDiv.classList.add("d-none"); // Hide spinner
                        resultsDiv.innerHTML += resultCard;
                    });
                }
            });
        });
     </script>     
</body>

<footer class="mt-5 text-center text-muted">
    <p>&copy; 2024 Search Aggregator. Built with <a href="https://flask.palletsprojects.com/" target="_blank">Flask</a> and <a href="https://getbootstrap.com/" target="_blank">Bootstrap</a> and <a href="https://chat.com/" target="_blank">ChatGPT</a>.</p>
</footer>

</html>
